import{a as E,b as l}from"./chunk-VSDMO5SJ.js";import{U as x,Y as d,a as i,b as p,l as u}from"./chunk-I6MSPIIX.js";var r=class{static KEY_BUDGETS="budgets";static KEY_EXPENSES="expenses";static KEY_INCOME="monthlyIncome";static KEY_API_STORAGE="gemini_api_key"};var m=class o{constructor(e,s){this.toastService=e;this.storageService=s;this.loadExpenses()}expensesSubject=new u([]);expenses$=this.expensesSubject.asObservable();loadExpenses(){let e=this.storageService.getItem(r.KEY_EXPENSES);if(e){let s=e.map(n=>p(i({},n),{date:new Date(n.date),createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt)}));this.expensesSubject.next(s)}else this.expensesSubject.next([])}saveExpenses(e){this.storageService.setItem(r.KEY_EXPENSES,e),this.expensesSubject.next(e)}getExpenses(){return this.expensesSubject.value}addExpense(e){let s=this.getExpenses(),n=new Date,t=p(i({},e),{id:s.length>0?Math.max(...s.map(c=>c.id))+1:1,date:new Date(e.date),createdAt:n,updatedAt:n});console.log("Adding expense:",{originalDate:e.date,convertedDate:t.date,year:t.date.getFullYear(),month:t.date.getMonth()+1,amount:t.amount,category:t.category});let a=[...s,t];return this.saveExpenses(a),t}updateExpense(e){let s=this.getExpenses(),n=s.findIndex(t=>t.id===e.id);if(n!==-1){let t=new Date,a=[...s];return a[n]=p(i({},e),{updatedAt:t}),this.saveExpenses(a),this.toastService.success("Expense updated successfully!"),!0}return this.toastService.error("Failed to update expense!"),!1}deleteExpense(e){let s=this.getExpenses(),n=s.findIndex(t=>t.id===e);if(n!==-1){let t=[...s];return t.splice(n,1),this.saveExpenses(t),!0}return!1}getMonthlyExpenses(e,s){return this.getExpenses().filter(t=>{let a=new Date(t.date);return a.getFullYear()===e&&a.getMonth()+1===s})}getMonthlySpent(e,s){let n=this.getMonthlyExpenses(e,s),t=n.reduce((a,c)=>a+c.amount,0);return console.log("getMonthlySpent:",{year:e,month:s,expensesFound:n.length,total:t,expenses:n.map(a=>({date:a.date,amount:a.amount,category:a.category}))}),t}static \u0275fac=function(s){return new(s||o)(d(E),d(l))};static \u0275prov=x({token:o,factory:o.\u0275fac,providedIn:"root"})};export{r as a,m as b};
