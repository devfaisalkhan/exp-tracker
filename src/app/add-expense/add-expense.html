<div class="container">
  <h2 class="mb-4">Add New Expense</h2>
  
  <div class="alert alert-warning" *ngIf="!hasMonthlyIncome">
    <h5><i class="bi bi-exclamation-triangle-fill me-2"></i>Monthly Income Not Set</h5>
    <p class="mb-3">Please set your monthly income before adding expenses to track your budget.</p>
    <a routerLink="/set-income" class="btn btn-primary">Set Monthly Income</a>
  </div>
  
  <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="needs-validation" novalidate *ngIf="hasMonthlyIncome">
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" 
                 class="form-control form-control-lg" 
                 id="title" 
                 formControlName="title">
          <div *ngIf="expenseForm.get('title')?.invalid && expenseForm.get('title')?.touched" class="text-danger mt-1">
            Title is required
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <label for="amount" class="form-label">Amount (PKR)</label>
          <input type="number" 
                 class="form-control form-control-lg" 
                 id="amount" 
                 formControlName="amount" 
                 min="0.01" 
                 step="0.01">
          <div *ngIf="expenseForm.get('amount')?.invalid && expenseForm.get('amount')?.touched" class="text-danger mt-1">
            Amount is required
          </div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="date" class="form-label">Date</label>
          <input type="date" 
                 class="form-control form-control-lg" 
                 id="date" 
                 formControlName="date">
          <div *ngIf="expenseForm.get('date')?.invalid && expenseForm.get('date')?.touched" class="text-danger mt-1">
            Date is required
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select class="form-select form-select-lg" 
                  id="category" 
                  formControlName="category">
            <option value="" disabled>Select a category</option>
            <option *ngFor="let category of expenseCategories" [value]="category">{{category}}</option>
          </select>
          <div *ngIf="expenseForm.get('category')?.invalid && expenseForm.get('category')?.touched" class="text-danger mt-1">
            Please select a category
          </div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="paymentMethod" class="form-label">Payment Method</label>
          <select class="form-select" 
                  id="paymentMethod" 
                  formControlName="paymentMethod">
            <option value="">Select payment method</option>
            <option *ngFor="let method of paymentMethods" [value]="method">{{method}}</option>
          </select>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <label for="tags" class="form-label">Tags (comma separated)</label>
          <input type="text" 
                 class="form-control" 
                 id="tags" 
                 formControlName="tags"
                 placeholder="e.g., business, urgent, receipt">
        </div>
      </div>
    </div>
    
    <div class="mb-4">
      <label for="notes" class="form-label">Notes</label>
      <textarea class="form-control" 
                id="notes" 
                formControlName="notes" 
                rows="3" 
                placeholder="Add any additional notes..."></textarea>
    </div>
    
    <div class="d-grid">
      <button type="submit" 
              class="btn btn-primary btn-lg" 
              [disabled]="expenseForm.invalid">
        Save Expense
      </button>
    </div>
  </form>
  
  <div class="card mt-4" *ngIf="hasMonthlyIncome">
    <div class="card-body">
      <h5 class="card-title">Current Month Budget</h5>
      <div class="d-flex justify-content-between mb-2">
        <span>Income:</span>
        <strong>PKR {{ currentMonthIncome | number:'1.2-2' }}</strong>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Spent:</span>
        <strong class="text-danger">PKR {{ currentMonthSpent | number:'1.2-2' }}</strong>
      </div>
      <div class="d-flex justify-content-between mb-3">
        <span>Remaining:</span>
        <strong [class.text-danger]="remainingBudget < 0" [class.text-success]="remainingBudget >= 0">
          PKR {{ remainingBudget | number:'1.2-2' }}
        </strong>
      </div>
      <div class="progress" style="height: 10px;">
        <div 
          class="progress-bar" 
          role="progressbar" 
          [style.width.%]="Math.min(100, percentageUsed)"
          [ngClass]="{
            'bg-success': percentageUsed < 80,
            'bg-warning': percentageUsed >= 80 && percentageUsed <= 100,
            'bg-danger': percentageUsed > 100
          }"
          [attr.aria-valuenow]="percentageUsed"
          aria-valuemin="0" 
          aria-valuemax="100">
        </div>
      </div>
      <div class="text-center mt-2">
        <small>{{ percentageUsed | number:'1.0-0' }}% of monthly budget used</small>
      </div>
    </div>
  </div>
</div>