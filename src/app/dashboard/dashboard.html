<div class="container-fluid dashboard-container">
  <div class="dashboard-header mb-4 d-flex justify-content-between align-items-center">
    <div>
      <h2 class="mb-0 fw-bold text-gradient">Dashboard</h2>
      <p class="text-secondary mb-0">Welcome back to your financial overview</p>
    </div>
    <div class="d-flex gap-2">
      <a routerLink="/set-income" class="btn btn-outline-light btn-sm rounded-pill px-3">
        <i class="bi bi-wallet2 me-2"></i>Set Income
      </a>
    </div>
  </div>

  <!-- Monthly Budget Summary -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="glass-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h5 class="text-white mb-1">Monthly Budget</h5>
            <p class="text-secondary mb-0 small">{{ currentYear }} - {{ currentMonth | date:'MMMM' }}</p>
          </div>
          <div class="text-end">
            <h3 class="mb-0 fw-bold" [class.text-danger]="isOverBudget" [class.text-success]="!isOverBudget">
              {{ remainingBudget | number:'1.0-0' }} <small class="fs-6 text-secondary">PKR left</small>
            </h3>
          </div>
        </div>

        <!-- Progress bar -->
        <div class="mb-4">
          <div class="d-flex justify-content-between mb-2">
            <small class="text-secondary">Spent: {{ currentMonthSpent | number:'1.0-0' }}</small>
            <small class="text-secondary">Limit: {{ currentMonthIncome | number:'1.0-0' }}</small>
          </div>
          <div class="progress bg-dark" style="height: 8px; border-radius: 4px;">
            <div class="progress-bar" role="progressbar" [style.width.%]="Math.min(100, percentageUsed)" [ngClass]="{
                'bg-gradient-success': percentageUsed < 80,
                'bg-gradient-warning': percentageUsed >= 80 && percentageUsed <= 100,
                'bg-gradient-danger': percentageUsed > 100
              }" [attr.aria-valuenow]="percentageUsed" aria-valuemin="0" aria-valuemax="100">
            </div>
          </div>
        </div>

        <div class="row g-3">
          <div class="col-4">
            <div class="p-3 rounded-3 bg-white-5 text-center">
              <small class="d-block text-secondary mb-1">Income</small>
              <span class="fw-bold text-white">{{ currentMonthIncome !== null ? (currentMonthIncome | number:'1.0-0') :
                '-' }}</span>
            </div>
          </div>
          <div class="col-4">
            <div class="p-3 rounded-3 bg-white-5 text-center">
              <small class="d-block text-secondary mb-1">Spent</small>
              <span class="fw-bold text-white">{{ currentMonthSpent | number:'1.0-0' }}</span>
            </div>
          </div>
          <div class="col-4">
            <div class="p-3 rounded-3 bg-white-5 text-center">
              <small class="d-block text-secondary mb-1">Used</small>
              <span class="fw-bold" [class.text-danger]="percentageUsed > 100">{{ percentageUsed | number:'1.0-0'
                }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="glass-card h-100 p-3 text-center">
        <div class="icon-box bg-primary-gradient mb-3 mx-auto">
          <i class="bi bi-receipt text-white fs-5"></i>
        </div>
        <h3 class="fw-bold text-white mb-0">{{ totalExpenses }}</h3>
        <small class="text-secondary">Total Transactions</small>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="glass-card h-100 p-3 text-center">
        <div class="icon-box bg-success-gradient mb-3 mx-auto">
          <i class="bi bi-cash-stack text-white fs-5"></i>
        </div>
        <h3 class="fw-bold text-white mb-0">{{ totalAmount | number:'1.0-0' }}</h3>
        <small class="text-secondary">Total Spent</small>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="glass-card h-100 p-3 text-center">
        <div class="icon-box bg-info-gradient mb-3 mx-auto">
          <i class="bi bi-tag text-white fs-5"></i>
        </div>
        <h5 class="fw-bold text-white mb-0 text-truncate">{{ getTopCategory()?.category || '-' }}</h5>
        <small class="text-secondary">Top Category</small>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="glass-card h-100 p-3 text-center">
        <div class="icon-box bg-warning-gradient mb-3 mx-auto">
          <i class="bi bi-graph-up text-white fs-5"></i>
        </div>
        <h3 class="fw-bold text-white mb-0">{{ totalExpenses > 0 ? (totalAmount / totalExpenses | number:'1.0-0') : '0'
          }}</h3>
        <small class="text-secondary">Avg. per Txn</small>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row g-4 mb-4">
    <!-- Weekly Activity -->
    <div class="col-12 col-lg-8">
      <div class="glass-card h-100">
        <h5 class="text-white mb-4">Weekly Activity</h5>
        <div class="chart-container" style="height: 250px;">
          <canvas baseChart [data]="weeklyChartData" [options]="chartOptions" [type]="weeklyChartType">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Category Breakdown -->
    <div class="col-12 col-lg-4">
      <div class="glass-card h-100">
        <h5 class="text-white mb-4">Spending by Category</h5>
        <div class="chart-container" style="height: 250px;">
          <canvas baseChart [data]="categoryChartData" [options]="chartOptions" [type]="categoryChartType">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Expenses -->
  <div class="glass-card mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="text-white mb-0">Recent Transactions</h5>
      <a routerLink="/expenses" class="btn btn-link text-accent text-decoration-none p-0">View All</a>
    </div>

    <div class="list-group list-group-flush bg-transparent">
      <div class="list-group-item bg-transparent border-bottom border-white-10 px-0 py-3"
        *ngFor="let expense of expenses | slice:0:5">
        <div class="d-flex align-items-center">
          <div class="icon-circle bg-white-5 me-3 text-accent">
            <i class="bi bi-bag"></i>
          </div>
          <div class="flex-grow-1">
            <h6 class="text-white mb-0">{{ expense.title }}</h6>
            <small class="text-secondary">{{ expense.date | date:'MMM d, y' }} â€¢ {{ expense.category }}</small>
          </div>
          <div class="text-end">
            <h6 class="text-white mb-0">- {{ expense.amount | number:'1.0-0' }}</h6>
          </div>
        </div>
      </div>

      <div class="text-center py-4" *ngIf="expenses.length === 0">
        <p class="text-secondary mb-0">No transactions yet</p>
      </div>
    </div>
  </div>

  <!-- Floating Action Button -->
  <!-- <div class="fab-container">
    <a routerLink="/add"
      class="btn btn-primary-gradient rounded-circle shadow-lg d-flex align-items-center justify-content-center"
      style="width: 60px; height: 60px;">
      <i class="bi bi-plus-lg fs-3"></i>
    </a>
  </div> -->
</div>