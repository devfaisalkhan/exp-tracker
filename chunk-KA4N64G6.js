import{a as ne}from"./chunk-BLONM6LW.js";import{a as $,b as g,c as K,d as z,f as Y,g as L,h as H,i as J,j as Q,k as W,l as X,m as Z,n as ee,p as te}from"./chunk-CKQHLOFP.js";import{f as V,j as k}from"./chunk-V45FDY2B.js";import{a as G}from"./chunk-YXOPXFX3.js";import{b as j}from"./chunk-PSV5QOAS.js";import{a as q}from"./chunk-H6ALTRBB.js";import{Db as O,Eb as v,Fa as m,Gb as h,Ka as f,Qa as F,Ua as c,cb as C,cc as N,db as s,dc as T,eb as i,ec as B,fb as t,ga as M,gb as p,ha as I,hb as w,ib as D,jb as S,jc as R,lc as U,rb as P,sb as A,ub as o,vb as _,wb as x}from"./chunk-OD3IFAOV.js";var re=(r,n,e)=>({"bg-success":r,"bg-warning":n,"bg-danger":e});function ae(r,n){r&1&&(i(0,"div",5)(1,"h5"),p(2,"i",6),o(3,"Monthly Income Not Set"),t(),i(4,"p",7),o(5,"Please set your monthly income before adding expenses to track your budget."),t(),i(6,"a",8),o(7,"Set Monthly Income"),t()())}function me(r,n){r&1&&(i(0,"div",32),o(1," Title is required "),t())}function le(r,n){r&1&&(i(0,"div",32),o(1," Amount is required "),t())}function de(r,n){r&1&&(i(0,"div",32),o(1," Date is required "),t())}function se(r,n){if(r&1&&(i(0,"option",33),o(1),t()),r&2){let e=n.$implicit;s("value",e),m(),_(e)}}function ce(r,n){r&1&&(i(0,"div",32),o(1," Please select a category "),t())}function pe(r,n){if(r&1&&(i(0,"option",33),o(1),t()),r&2){let e=n.$implicit;s("value",e),m(),_(e)}}function ue(r,n){if(r&1){let e=w();i(0,"form",9),D("ngSubmit",function(){M(e);let l=S();return I(l.onSubmit())}),i(1,"div",10)(2,"div",11)(3,"div",7)(4,"label",12),o(5,"Title"),t(),p(6,"input",13),c(7,me,2,0,"div",14),t()(),i(8,"div",11)(9,"div",7)(10,"label",15),o(11,"Amount (PKR)"),t(),p(12,"input",16),c(13,le,2,0,"div",14),t()()(),i(14,"div",10)(15,"div",11)(16,"div",7)(17,"label",17),o(18,"Date"),t(),p(19,"input",18),c(20,de,2,0,"div",14),t()(),i(21,"div",11)(22,"div",7)(23,"label",19),o(24,"Category"),t(),i(25,"select",20)(26,"option",21),o(27,"Select a category"),t(),c(28,se,2,2,"option",22),t(),c(29,ce,2,0,"div",14),t()()(),i(30,"div",10)(31,"div",11)(32,"div",7)(33,"label",23),o(34,"Payment Method"),t(),i(35,"select",24)(36,"option",25),o(37,"Select payment method"),t(),c(38,pe,2,2,"option",22),t()()(),i(39,"div",11)(40,"div",7)(41,"label",26),o(42,"Tags (comma separated)"),t(),p(43,"input",27),t()()(),i(44,"div",1)(45,"label",28),o(46,"Notes"),t(),p(47,"textarea",29),t(),i(48,"div",30)(49,"button",31),o(50," Save Expense "),t()()()}if(r&2){let e,a,l,u,d=S();s("formGroup",d.expenseForm),m(7),s("ngIf",((e=d.expenseForm.get("title"))==null?null:e.invalid)&&((e=d.expenseForm.get("title"))==null?null:e.touched)),m(6),s("ngIf",((a=d.expenseForm.get("amount"))==null?null:a.invalid)&&((a=d.expenseForm.get("amount"))==null?null:a.touched)),m(7),s("ngIf",((l=d.expenseForm.get("date"))==null?null:l.invalid)&&((l=d.expenseForm.get("date"))==null?null:l.touched)),m(8),s("ngForOf",d.expenseCategories),m(),s("ngIf",((u=d.expenseForm.get("category"))==null?null:u.invalid)&&((u=d.expenseForm.get("category"))==null?null:u.touched)),m(9),s("ngForOf",d.paymentMethods),m(11),s("disabled",d.expenseForm.invalid)}}function ge(r,n){if(r&1&&(i(0,"div",34)(1,"div",35)(2,"h5",36),o(3,"Current Month Budget"),t(),i(4,"div",37)(5,"span"),o(6,"Income:"),t(),i(7,"strong"),o(8),v(9,"number"),t()(),i(10,"div",37)(11,"span"),o(12,"Spent:"),t(),i(13,"strong",38),o(14),v(15,"number"),t()(),i(16,"div",39)(17,"span"),o(18,"Remaining:"),t(),i(19,"strong"),o(20),v(21,"number"),t()(),i(22,"div",40),p(23,"div",41),t(),i(24,"div",42)(25,"small"),o(26),v(27,"number"),t()()()()),r&2){let e=S();m(8),x("PKR ",h(9,12,e.currentMonthIncome,"1.2-2")),m(6),x("PKR ",h(15,15,e.currentMonthSpent,"1.2-2")),m(5),A("text-danger",e.remainingBudget<0)("text-success",e.remainingBudget>=0),m(),x(" PKR ",h(21,18,e.remainingBudget,"1.2-2")," "),m(3),P("width",e.Math.min(100,e.percentageUsed),"%"),s("ngClass",O(24,re,e.percentageUsed<80,e.percentageUsed>=80&&e.percentageUsed<=100,e.percentageUsed>100)),C("aria-valuenow",e.percentageUsed),m(3),x("",h(27,21,e.percentageUsed,"1.0-0"),"% of monthly budget used")}}var ie=class r{constructor(n,e,a,l){this.fb=n;this.expenseService=e;this.incomeService=a;this.toastService=l}expenseForm;expenseCategories=Object.values(ne);paymentMethods=["Cash","Credit Card","Debit Card","Bank Transfer","Mobile Payment","Other"];defaultDate=new Date;hasMonthlyIncome=!1;currentMonthIncome=0;currentMonthSpent=0;remainingBudget=0;percentageUsed=0;Math=Math;ngOnInit(){this.checkMonthlyIncome(),this.initForm()}checkMonthlyIncome(){let n=new Date,e=n.getFullYear(),a=n.getMonth()+1,l=this.incomeService.getMonthlyIncome(e,a);this.hasMonthlyIncome=!!l,l&&(this.currentMonthIncome=l.amount,this.currentMonthSpent=this.expenseService.getMonthlySpent(e,a),this.remainingBudget=this.incomeService.getRemainingBudget(e,a),this.percentageUsed=this.incomeService.getPercentageUsed(e,a))}initForm(){this.expenseForm=this.fb.group({title:["",[g.required]],amount:["",[g.required,g.min(.01)]],date:[this.formatDateForInput(this.defaultDate),[g.required]],category:["",[g.required]],paymentMethod:[""],notes:[""],tags:[""]})}formatDateForInput(n){let e=n.getFullYear(),a=(n.getMonth()+1).toString().padStart(2,"0"),l=n.getDate().toString().padStart(2,"0");return`${e}-${a}-${l}`}onSubmit(){if(this.expenseForm.valid){let n=this.expenseForm.value,e=n.tags?n.tags.split(",").map(y=>y.trim()).filter(y=>y):[],a={title:n.title,amount:parseFloat(n.amount),date:new Date(n.date),category:n.category,notes:n.notes,paymentMethod:n.paymentMethod,tags:e.length>0?e:void 0},l=new Date(n.date),u=l.getFullYear(),d=l.getMonth()+1,b=this.incomeService.getMonthlyIncome(u,d);if(b){let E=this.expenseService.getMonthlySpent(u,d)+a.amount;if(E>b.amount){let oe=E-b.amount;confirm(`This expense will exceed your monthly income by ${oe.toFixed(2)} PKR. Do you want to add it anyway as "Over Budget"?`)?(this.expenseService.addExpense(a),this.expenseForm.reset({title:"",amount:"",date:this.formatDateForInput(this.defaultDate),category:"",paymentMethod:"",notes:"",tags:""}),this.toastService.warning("Expense added successfully (Over Budget)!"),this.checkMonthlyIncome()):this.toastService.info("Expense not added.")}else this.expenseService.addExpense(a),this.expenseForm.reset({title:"",amount:"",date:this.formatDateForInput(this.defaultDate),category:"",paymentMethod:"",notes:"",tags:""}),this.toastService.success("Expense added successfully!"),this.checkMonthlyIncome()}else this.expenseService.addExpense(a),this.expenseForm.reset({title:"",amount:"",date:this.formatDateForInput(this.defaultDate),category:"",paymentMethod:"",notes:"",tags:""}),this.toastService.success("Expense added successfully!")}else this.toastService.error("Please fill in all required fields correctly.")}static \u0275fac=function(e){return new(e||r)(f(ee),f(j),f(G),f(q))};static \u0275cmp=F({type:r,selectors:[["app-add-expense"]],decls:6,vars:3,consts:[[1,"container"],[1,"mb-4"],["class","alert alert-warning",4,"ngIf"],["class","needs-validation","novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["class","card mt-4",4,"ngIf"],[1,"alert","alert-warning"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-3"],["routerLink","/set-income",1,"btn","btn-primary"],["novalidate","",1,"needs-validation",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-6"],["for","title",1,"form-label"],["type","text","id","title","formControlName","title",1,"form-control","form-control-lg"],["class","text-danger mt-1",4,"ngIf"],["for","amount",1,"form-label"],["type","number","id","amount","formControlName","amount","min","0.01","step","0.01",1,"form-control","form-control-lg"],["for","date",1,"form-label"],["type","date","id","date","formControlName","date",1,"form-control","form-control-lg"],["for","category",1,"form-label"],["id","category","formControlName","category",1,"form-select","form-select-lg"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","paymentMethod",1,"form-label"],["id","paymentMethod","formControlName","paymentMethod",1,"form-select"],["value",""],["for","tags",1,"form-label"],["type","text","id","tags","formControlName","tags","placeholder","e.g., business, urgent, receipt",1,"form-control"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","rows","3","placeholder","Add any additional notes...",1,"form-control"],[1,"d-grid"],["type","submit",1,"btn","btn-primary","btn-lg",3,"disabled"],[1,"text-danger","mt-1"],[3,"value"],[1,"card","mt-4"],[1,"card-body"],[1,"card-title"],[1,"d-flex","justify-content-between","mb-2"],[1,"text-danger"],[1,"d-flex","justify-content-between","mb-3"],[1,"progress",2,"height","10px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar",3,"ngClass"],[1,"text-center","mt-2"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"h2",1),o(2,"Add New Expense"),t(),c(3,ae,8,0,"div",2)(4,ue,51,8,"form",3)(5,ge,28,28,"div",4),t()),e&2&&(m(3),s("ngIf",!a.hasMonthlyIncome),m(),s("ngIf",a.hasMonthlyIncome),m(),s("ngIf",a.hasMonthlyIncome))},dependencies:[U,N,T,B,te,Y,W,X,$,L,Q,K,z,Z,H,J,k,V,R],styles:[".container[_ngcontent-%COMP%]{max-width:100%;padding:1rem;margin:0 auto}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{margin-bottom:.75rem;border-radius:12px;border:2px solid #e9ecef;padding:.8rem 1rem;font-size:1rem;transition:border-color .2s}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.25rem;display:block}.btn-primary[_ngcontent-%COMP%]{width:100%;padding:.8rem;font-size:1.1rem;border-radius:12px;margin-top:1rem}@media (max-width: 576px){.container[_ngcontent-%COMP%]{padding:.75rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{padding:.7rem .8rem;font-size:.95rem;margin-bottom:.6rem}.btn-primary[_ngcontent-%COMP%]{padding:.7rem;font-size:1rem;margin-top:.75rem}}"]})};export{ie as AddExpense};
