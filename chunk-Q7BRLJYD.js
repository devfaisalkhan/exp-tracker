import{a as Y,b as J,c as H,d as Q,e as U,f as X,g as Z,h as ee,i as te,j as ie,k as ne,l as ae,m as re}from"./chunk-FMAJQSZ4.js";import{a as Se}from"./chunk-BLONM6LW.js";import{a as oe}from"./chunk-G6TGKG62.js";import{a as de,b as f,c as le,d as me,f as se,g as ue,h as ge,i as pe,j as ce,k as ve,l as be,m as fe,n as he,p as ye}from"./chunk-QAZQDVSC.js";import{Ea as k,Ia as p,Jb as G,Kb as j,Lb as $,Mb as L,Ob as W,P as T,Qb as z,Sa as R,Ta as m,Ua as a,Va as i,Wa as g,Xa as V,Ya as A,Z as N,Za as O,_ as M,a as C,b as x,bb as K,cb as h,db as r,eb as _,fb as c,mb as v,nb as q,ob as b,ta as o,ya as P}from"./chunk-MFZMDKGS.js";var w=class d{localStorageKey="budgets";constructor(){}loadBudgets(){let n=localStorage.getItem(this.localStorageKey);return n?JSON.parse(n).map(e=>x(C({},e),{startDate:new Date(e.startDate),endDate:e.endDate?new Date(e.endDate):void 0,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})):[]}saveBudgets(n){localStorage.setItem(this.localStorageKey,JSON.stringify(n))}getBudgets(){return this.loadBudgets()}getBudgetByCategory(n){return this.loadBudgets().find(e=>e.categoryId===n&&(!e.endDate||new Date(e.endDate)>=new Date))}addBudget(n){let t=this.loadBudgets(),e=x(C({},n),{id:t.length>0?Math.max(...t.map(l=>l.id))+1:1,createdAt:new Date,updatedAt:new Date});return t.push(e),this.saveBudgets(t),e}updateBudget(n){let t=this.loadBudgets(),e=t.findIndex(l=>l.id===n.id);return e!==-1?(t[e]=x(C({},n),{updatedAt:new Date}),this.saveBudgets(t),!0):!1}deleteBudget(n){let t=this.loadBudgets(),e=t.findIndex(l=>l.id===n);return e!==-1?(t.splice(e,1),this.saveBudgets(t),!0):!1}static \u0275fac=function(t){return new(t||d)};static \u0275prov=T({token:d,factory:d.\u0275fac,providedIn:"root"})};function _e(d,n){d&1&&(a(0,"div",37),r(1," Budget name is required (minimum 3 characters) "),i())}function Ee(d,n){if(d&1&&(a(0,"option",38),r(1),i()),d&2){let t=n.$implicit;m("value",t),o(),_(t)}}function De(d,n){d&1&&(a(0,"div",37),r(1," Please select a category "),i())}function Fe(d,n){d&1&&(a(0,"div",37),r(1," Amount is required and must be greater than 0 "),i())}function Ie(d,n){if(d&1&&(a(0,"option",38),r(1),i()),d&2){let t=n.$implicit;m("value",t.value),o(),_(t.label)}}function Pe(d,n){d&1&&(a(0,"div",37),r(1," Please select a period "),i())}function we(d,n){d&1&&(a(0,"div",37),r(1," Please select a start date "),i())}function Ae(d,n){d&1&&(a(0,"tr")(1,"td",39),r(2," No budgets created yet. Create your first budget above. "),i()())}function Oe(d,n){if(d&1){let t=V();a(0,"tr")(1,"td"),r(2),i(),a(3,"td")(4,"span",40),r(5),i()(),a(6,"td"),r(7),v(8,"number"),i(),a(9,"td"),r(10),v(11,"number"),i(),a(12,"td")(13,"span"),r(14),v(15,"number"),i()(),a(16,"td"),r(17),v(18,"titlecase"),i(),a(19,"td")(20,"div",41)(21,"div",42)(22,"div",43),g(23,"div",44),i()(),a(24,"span",45),r(25),v(26,"number"),i()()(),a(27,"td")(28,"button",46),A("click",function(){let l=N(t).$implicit,s=O();return M(s.deleteBudget(l.id))}),g(29,"i",47),r(30," Delete "),i()()()}if(d&2){let t=n.$implicit,e=O();o(2),_(t.name),o(3),_(t.categoryId),o(2),c("PKR ",b(8,15,t.amount,"1.2-2")),o(3),c("PKR ",b(11,18,t.currentSpent,"1.2-2")),o(3),h("text-success",t.remainingAmount>=0)("text-danger",t.remainingAmount<0),o(),c(" PKR ",b(15,21,t.remainingAmount,"1.2-2")," "),o(3),_(q(18,24,t.period)),o(6),K("width",t.spentPercentage,"%"),m("ngClass",e.getBudgetStatusClass(t)),R("aria-valuenow",t.spentPercentage),o(2),c("",b(26,26,t.spentPercentage,"1.0-0"),"%")}}Q.register(H,Y,J,ne,ae,Z,X,te,ie,ee,U);var Be=class d{constructor(n,t,e){this.fb=n;this.budgetService=t;this.expenseService=e}budgetForm;budgets=[];expenseCategories=Object.values(Se);periods=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}];totalBudgets=0;totalAllocated=0;totalSpent=0;totalRemaining=0;budgetChartType="doughnut";budgetChartData={labels:[],datasets:[{data:[],backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF","#4BC0C0","#FF6384","#36A2EB","#FFCE56"]}]};chartOptions={responsive:!0,maintainAspectRatio:!1};ngOnInit(){this.initForm(),this.loadBudgets()}initForm(){this.budgetForm=this.fb.group({name:["",[f.required,f.minLength(3)]],categoryId:["",[f.required]],amount:["",[f.required,f.min(.01)]],period:["monthly",[f.required]],startDate:[this.getTodayString(),[f.required]]})}getTodayString(){return new Date().toISOString().split("T")[0]}loadBudgets(){let n=this.budgetService.getBudgets(),t=this.expenseService.getExpenses();this.budgets=n.map(e=>{let s=t.filter(u=>u.category===e.categoryId&&new Date(u.date)>=new Date(e.startDate)&&(!e.endDate||new Date(u.date)<=new Date(e.endDate))).reduce((u,B)=>u+B.amount,0),y=e.amount>0?s/e.amount*100:0,S=e.amount-s;return x(C({},e),{currentSpent:s,spentPercentage:y,remainingAmount:S})}),this.updateBudgetChart()}updateBudgetChart(){let n=this.budgets.filter(t=>t.currentSpent>0||t.amount>0);n.length>0?(this.budgetChartData.labels=n.map(t=>`${t.name} (${t.categoryId})`),this.budgetChartData.datasets[0].data=n.map(t=>t.currentSpent)):(this.budgetChartData.labels=["No budget data"],this.budgetChartData.datasets[0].data=[1]),this.totalBudgets=this.budgets.length,this.totalAllocated=this.budgets.reduce((t,e)=>t+e.amount,0),this.totalSpent=this.budgets.reduce((t,e)=>t+e.currentSpent,0),this.totalRemaining=this.budgets.reduce((t,e)=>t+e.remainingAmount,0)}onSubmit(){if(this.budgetForm.valid){let n=this.budgetForm.value,t={name:n.name,categoryId:n.categoryId,amount:n.amount,period:n.period,startDate:new Date(n.startDate),endDate:this.calculateEndDate(n.startDate,n.period),currentSpent:0};this.budgetService.addBudget(t),this.budgetForm.reset({name:"",categoryId:"",amount:"",period:"monthly",startDate:this.getTodayString()}),this.loadBudgets()}}calculateEndDate(n,t){let e=new Date(n),l=new Date(e);switch(t){case"daily":l.setDate(e.getDate()+1);break;case"weekly":l.setDate(e.getDate()+7);break;case"monthly":l.setMonth(e.getMonth()+1);break;case"yearly":l.setFullYear(e.getFullYear()+1);break;default:l.setMonth(e.getMonth()+1);break}return l}deleteBudget(n){confirm("Are you sure you want to delete this budget?")&&this.budgetService.deleteBudget(n)&&this.loadBudgets()}getBudgetStatusClass(n){return n.spentPercentage>=100?"bg-danger":n.spentPercentage>=80?"bg-warning":"bg-success"}static \u0275fac=function(t){return new(t||d)(P(he),P(w),P(oe))};static \u0275cmp=k({type:d,selectors:[["app-budgets"]],decls:119,vars:37,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-12"],[1,"text-muted"],[1,"row","mb-4"],[1,"col-md-8","offset-md-2"],[1,"card"],[1,"card-header"],[1,"card-body"],["novalidate","",1,"needs-validation",3,"ngSubmit","formGroup"],[1,"col-md-6"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name","placeholder","e.g., Monthly Grocery Budget",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","categoryId",1,"form-label"],["id","categoryId","formControlName","categoryId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-4"],["for","amount",1,"form-label"],["type","number","id","amount","formControlName","amount","min","0.01","step","0.01","placeholder","0.00",1,"form-control"],["for","period",1,"form-label"],["id","period","formControlName","period",1,"form-select"],["for","startDate",1,"form-label"],["type","date","id","startDate","formControlName","startDate",1,"form-control"],[1,"d-grid"],["type","submit",1,"btn","btn-primary","btn-lg",3,"disabled"],[1,"col-md-8"],[1,"chart-container",2,"height","400px"],["baseChart","",3,"data","options","type"],[1,"card-title"],[1,"card-text"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"invalid-feedback"],[3,"value"],["colspan","8",1,"text-center","text-muted"],[1,"badge","bg-primary"],[1,"d-flex","align-items-center"],[1,"flex-grow-1","me-2"],[1,"progress",2,"height","10px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar",3,"ngClass"],[1,"small"],["title","Delete",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"]],template:function(t,e){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),r(4,"Budget Management"),i(),a(5,"p",3),r(6,"Set and track your spending limits by category"),i()()(),a(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"h5"),r(12,"Create New Budget"),i()(),a(13,"div",8)(14,"form",9),A("ngSubmit",function(){return e.onSubmit()}),a(15,"div",1)(16,"div",10)(17,"div",11)(18,"label",12),r(19,"Budget Name"),i(),g(20,"input",13),p(21,_e,2,0,"div",14),i()(),a(22,"div",10)(23,"div",11)(24,"label",15),r(25,"Category"),i(),a(26,"select",16)(27,"option",17),r(28,"Select a category"),i(),p(29,Ee,2,2,"option",18),i(),p(30,De,2,0,"div",14),i()()(),a(31,"div",1)(32,"div",19)(33,"div",11)(34,"label",20),r(35,"Budget Amount"),i(),g(36,"input",21),p(37,Fe,2,0,"div",14),i()(),a(38,"div",19)(39,"div",11)(40,"label",22),r(41,"Period"),i(),a(42,"select",23),p(43,Ie,2,2,"option",18),i(),p(44,Pe,2,0,"div",14),i()(),a(45,"div",19)(46,"div",11)(47,"label",24),r(48,"Start Date"),i(),g(49,"input",25),p(50,we,2,0,"div",14),i()()(),a(51,"div",26)(52,"button",27),r(53," Create Budget "),i()()()()()()(),a(54,"div",4)(55,"div",2)(56,"div",6)(57,"div",7)(58,"h5"),r(59,"Budget Overview"),i()(),a(60,"div",8)(61,"div",1)(62,"div",28)(63,"div",29),g(64,"canvas",30),i()(),a(65,"div",19)(66,"div",6)(67,"div",8)(68,"h5",31),r(69,"Budget Summary"),i(),a(70,"p",32)(71,"strong"),r(72,"Total Budgets:"),i(),r(73),g(74,"br"),a(75,"strong"),r(76,"Total Allocated:"),i(),r(77),v(78,"number"),g(79,"br"),a(80,"strong"),r(81,"Total Spent:"),i(),r(82),v(83,"number"),g(84,"br"),a(85,"strong"),r(86,"Remaining:"),i(),r(87),v(88,"number"),i()()()()()()()()(),a(89,"div",1)(90,"div",2)(91,"div",6)(92,"div",7)(93,"h5"),r(94,"Active Budgets"),i()(),a(95,"div",8)(96,"div",33)(97,"table",34)(98,"thead")(99,"tr")(100,"th"),r(101,"Name"),i(),a(102,"th"),r(103,"Category"),i(),a(104,"th"),r(105,"Budget"),i(),a(106,"th"),r(107,"Spent"),i(),a(108,"th"),r(109,"Remaining"),i(),a(110,"th"),r(111,"Period"),i(),a(112,"th"),r(113,"Status"),i(),a(114,"th"),r(115,"Actions"),i()()(),a(116,"tbody"),p(117,Ae,3,0,"tr",35)(118,Oe,31,29,"tr",36),i()()()()()()()()),t&2){let l,s,y,S,u,B,E,D,F,I;o(14),m("formGroup",e.budgetForm),o(6),h("is-invalid",((l=e.budgetForm.get("name"))==null?null:l.invalid)&&((l=e.budgetForm.get("name"))==null?null:l.touched)),o(),m("ngIf",((s=e.budgetForm.get("name"))==null?null:s.invalid)&&((s=e.budgetForm.get("name"))==null?null:s.touched)),o(5),h("is-invalid",((y=e.budgetForm.get("categoryId"))==null?null:y.invalid)&&((y=e.budgetForm.get("categoryId"))==null?null:y.touched)),o(3),m("ngForOf",e.expenseCategories),o(),m("ngIf",((S=e.budgetForm.get("categoryId"))==null?null:S.invalid)&&((S=e.budgetForm.get("categoryId"))==null?null:S.touched)),o(6),h("is-invalid",((u=e.budgetForm.get("amount"))==null?null:u.invalid)&&((u=e.budgetForm.get("amount"))==null?null:u.touched)),o(),m("ngIf",((B=e.budgetForm.get("amount"))==null?null:B.invalid)&&((B=e.budgetForm.get("amount"))==null?null:B.touched)),o(5),h("is-invalid",((E=e.budgetForm.get("period"))==null?null:E.invalid)&&((E=e.budgetForm.get("period"))==null?null:E.touched)),o(),m("ngForOf",e.periods),o(),m("ngIf",((D=e.budgetForm.get("period"))==null?null:D.invalid)&&((D=e.budgetForm.get("period"))==null?null:D.touched)),o(5),h("is-invalid",((F=e.budgetForm.get("startDate"))==null?null:F.invalid)&&((F=e.budgetForm.get("startDate"))==null?null:F.touched)),o(),m("ngIf",((I=e.budgetForm.get("startDate"))==null?null:I.invalid)&&((I=e.budgetForm.get("startDate"))==null?null:I.touched)),o(2),m("disabled",e.budgetForm.invalid),o(12),m("data",e.budgetChartData)("options",e.chartOptions)("type",e.budgetChartType),o(9),c(" ",e.totalBudgets),o(4),c(" PKR ",b(78,28,e.totalAllocated,"1.2-2")),o(5),c(" PKR ",b(83,31,e.totalSpent,"1.2-2")),o(5),c(" PKR ",b(88,34,e.totalRemaining,"1.2-2")," "),o(30),m("ngIf",e.budgets.length===0),o(),m("ngForOf",e.budgets)}},dependencies:[z,G,j,$,ye,se,ve,be,de,ue,ce,le,me,fe,ge,pe,re,W,L],styles:[".card[_ngcontent-%COMP%]{box-shadow:0 4px 6px #0000001a;border:none;margin-bottom:1.5rem}.card-header[_ngcontent-%COMP%]{font-weight:600;background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.125)}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600}.badge[_ngcontent-%COMP%]{font-size:.85em}.progress[_ngcontent-%COMP%]{background-color:#e9ecef;border-radius:.25rem}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.card-body[_ngcontent-%COMP%]{padding:1rem}}"]})};export{Be as BudgetsComponent};
